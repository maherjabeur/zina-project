{% extends 'base.html.twig' %}

{% block title %}Gestion des Produits - Admin
{% endblock %}

{% block body %}
	<div class="container-fluid">
		<div
			class="row">
			<!-- Sidebar -->
			<nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
				<div class="position-sticky pt-3">
					<ul class="nav flex-column">
						<li class="nav-item">
							<a class="nav-link" href="{{ path('admin_dashboard') }}">
								<i class="fas fa-tachometer-alt"></i>
								Dashboard
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link active" href="{{ path('admin_products') }}">
								<i class="fas fa-tshirt"></i>
								Produits
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link " href="{{ path('admin_sizes') }}">
								<i class="fas fa-ruler"></i>
								Tailles
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link " href="{{ path('admin_categories') }}">
								<i class="fas fa-tags"></i>
								Catégories
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="{{ path('admin_orders') }}">
								<i class="fas fa-shopping-cart"></i>
								Commandes
								{% set pending_orders = count_pending_orders() %}
								{% if pending_orders > 0 %}
									<span class="badge bg-danger">{{ pending_orders }}</span>
								{% endif %}
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="{{ path('admin_slider') }}">
								<i class="fas fa-images"></i>
								Slider
							</a>
						</li>

					</ul>
				</div>
			</nav>

			<!-- Main content -->
			<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
				<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
					<h1 class="h2">Gestion des Produits</h1>
					<a href="{{ path('admin_product_new') }}" class="btn btn-primary">
						<i class="fas fa-plus"></i>
						Nouveau produit
					</a>
				</div>

				<!-- Barre de recherche -->
				<div class="row mb-4">
					<div class="col-md-6">
						<form method="GET" action="{{ path('admin_products') }}">
							<div class="input-group">
								<input type="text" class="form-control" name="search" value="{{ search }}" placeholder="Rechercher un produit...">
								<button class="btn btn-outline-primary" type="submit">
									<i class="fas fa-search"></i>
								</button>
								{% if search %}
									<a href="{{ path('admin_products') }}" class="btn btn-outline-secondary">
										<i class="fas fa-times"></i>
									</a>
								{% endif %}
							</div>
						</form>
					</div>
					<div class="col-md-6 text-md-end">
						<div class="btn-group">
							<button class="btn btn-outline-primary btn-sm" disabled>
								Total:
								{{ products.getTotalItemCount }}
								produit(s)
							</button>
							<button class="btn btn-outline-secondary btn-sm" disabled>
								Page
								{{ products.getCurrentPageNumber }}/{{ products.getPageCount }}
							</button>
						</div>
					</div>
				</div>

				<!-- Liste des produits -->
				<div class="card">
					<div class="card-body">
						{% if products|length > 0 %}
							<div class="table-responsive">
								<table class="table table-striped table-hover">
									<thead>
										<tr>
											<th>Image</th>
											<th>Nom</th>
											<th>Prix</th>
											<th>Stock</th>
											<th>Taille</th>
											<th>Couleur</th>
											<th>Catégorie</th>
											<th>Statut</th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody>
										{% for product in products %}
											<tr>
												<td>
													{% if product.images|length > 0 %}
														<img src="{{ asset('uploads/products/' ~ product.images.first.filename) }}" class="img-thumbnail" alt="{{ product.name }}" style="width: 50px; height: 50px; object-fit: cover;">
													{% else %}
														<img src="{{ asset('images/placeholder.jpg') }}" class="img-thumbnail" alt="Aucune image" style="width: 50px; height: 50px; object-fit: cover;">
													{% endif %}
												</td>
												<td>
													<strong>{{ product.name }}</strong>
													<br>
													<small class="text-muted">{{ product.description|slice(0, 50) }}...</small>
												</td>
												<td>{{ product.price }}
													Dt</td>
												<td>
													<span class="badge bg-{{ product.quantity > 10 ? 'success' : (product.quantity > 0 ? 'warning' : 'danger') }}">
														{{ product.quantity }}
													</span>
												</td>
<td>
    {% if product.sizes|length > 0 %}
        {% for size in product.sizes %}
            <span class="badge bg-light text-dark me-1">{{ size.name }}</span>
        {% endfor %}
    {% else %}
        <span class="text-muted">Aucune</span>
    {% endif %}
</td>
												<td>
													<span class="badge bg-light text-dark">{{ product.color }}</span>
												</td>
												<td>
													<span class="badge bg-info">{{ product.category }}</span>
												</td>
												<td>
													{% if product.isActive %}
														<span class="badge bg-success">Actif</span>
													{% else %}
														<span class="badge bg-secondary">Inactif</span>
													{% endif %}
												</td>
												<td>
													<div class="btn-group btn-group-sm">
														<a href="{{ path('product_detail', {'id': product.id}) }}" class="btn btn-outline-primary" title="Voir en boutique" target="_blank">
															<i class="fas fa-eye"></i>
														</a>
														<a href="{{ path('admin_product_edit', {'id': product.id}) }}" class="btn btn-outline-secondary" title="Modifier">
															<i class="fas fa-edit"></i>
														</a>
														<form method="POST" action="{{ path('admin_product_toggle', {'id': product.id}) }}" class="d-inline">
															<button type="submit" class="btn btn-{{ product.isActive ? 'warning' : 'success' }}" title="{{ product.isActive ? 'Désactiver' : 'Activer' }}">
																<i class="fas fa-{{ product.isActive ? 'pause' : 'play' }}"></i>
															</button>
														</form>
														<form method="POST" action="{{ path('admin_product_delete', {'id': product.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce produit ?')" class="d-inline">
															<button type="submit" class="btn btn-outline-danger" title="Supprimer">
																<i class="fas fa-trash"></i>
															</button>
														</form>
													</div>
													<a href="{{ path('admin_product_images', {'id': product.id}) }}" class="btn btn-outline-info" title="Gérer les images">
														<i class="fas fa-images"></i>
													</a>
												</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>

							<!-- Pagination -->
							<div class="d-flex justify-content-between align-items-center mt-4">
								<div>
									<small class="text-muted">
										Affichage de
										{{ products.getCurrentPageNumber * products.getItemNumberPerPage - products.getItemNumberPerPage + 1 }}
										à
										{{ min(products.getCurrentPageNumber * products.getItemNumberPerPage, products.getTotalItemCount) }}
										sur
										{{ products.getTotalItemCount }}
										produit(s)
									</small>
								</div>
								<div>
									{{ knp_pagination_render(products, '@KnpPaginator/Pagination/twitter_bootstrap_v4_pagination.html.twig', {'translation_domain': 'messages'}) }}
								</div>
							</div>
						{% else %}
							<div class="text-center py-5">
								<i class="fas fa-tshirt fa-3x text-muted mb-3"></i>
								<h3>
									{% if search %}
										Aucun produit trouvé pour "{{ search }}"
									{% else %}
										Aucun produit
									{% endif %}
								</h3>
								<p class="text-muted">
									{% if search %}
										Essayez avec d'autres termes de recherche.
									{% else %}
										Commencez par créer votre premier produit.
									{% endif %}
								</p>
								<a href="{{ path('admin_product_new') }}" class="btn btn-primary">
									<i class="fas fa-plus"></i>
									Créer un produit
								</a>
							</div>
						{% endif %}
					</div>
				</div>
			</main>
		</div>
	</div>
{% endblock %}
